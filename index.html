<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <meta name="theme-color" content="#2D1B00" />
    <title>Jump And Say</title>
    <link id="favicon" rel="icon" type="image/svg+xml" href="https://cdn.maskmysheet.com/assets/kenney/Vector/Tiles/hud_player_pink.svg" />
    <script>
      (function() {
        var link = document.getElementById('favicon');
        var img = new Image();
        img.onerror = function() {
          link.href = '/assets/kenney/Vector/Tiles/hud_player_pink.svg';
        };
        img.src = link.href;
      })();
    </script>
    <link rel="manifest" href="/manifest.json" />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['"FredokaBoot"', '"ZCOOL KuaiLe"', '"PingFang SC"', '"Hiragino Sans GB"', '"Microsoft YaHei"', '"Noto Sans CJK SC"', 'system-ui', '-apple-system', 'sans-serif'],
              display: ['"FredokaBoot"', '"ZCOOL KuaiLe"', '"PingFang SC"', '"Hiragino Sans GB"', '"Microsoft YaHei"', '"Noto Sans CJK SC"', 'system-ui', '-apple-system', 'sans-serif'],
            },
            colors: {
              kenney: {
                blue: '#4c99ff',
                green: '#77b039',
                red: '#ff5c5c',
                yellow: '#ffcc00',
                brown: '#a67c52',
                dark: '#333333',
                light: '#f5f5f5',
              }
            },
            boxShadow: {
              'kenney': '0 6px 0 rgba(0,0,0,0.2)',
              'kenney-active': '0 2px 0 rgba(0,0,0,0.2)',
            },
            borderRadius: {
              'kenney': '24px',
            },
            borderWidth: {
              'kenney': '4px',
            }
          }
        }
      }
    </script>
    <link
      rel="preload"
      href="https://cdn.maskmysheet.com/jump-and-say-themes-pic/assets/fonts/Zcool/zcool-kuaile-chinese-simplified-400-normal.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <style>
      @font-face {
        font-family: 'FredokaBoot';
        src: url('https://cdn.maskmysheet.com/jump-and-say-themes-pic/assets/fonts/Fredoka/static/Fredoka-Regular.ttf') format('truetype'),
             url('/assets/fonts/Fredoka/static/Fredoka-Regular.ttf') format('truetype');
        font-weight: 400;
        font-style: normal;
        font-display: swap;
      }
      @font-face {
        font-family: 'FredokaBoot';
        src: url('https://cdn.maskmysheet.com/jump-and-say-themes-pic/assets/fonts/Fredoka/static/Fredoka-Bold.ttf') format('truetype'),
             url('/assets/fonts/Fredoka/static/Fredoka-Bold.ttf') format('truetype');
        font-weight: 700;
        font-style: normal;
        font-display: swap;
      }
      @font-face {
        font-family: 'FredokaBoot';
        src: url('https://cdn.maskmysheet.com/jump-and-say-themes-pic/assets/fonts/Fredoka/static/Fredoka-Bold.ttf') format('truetype'),
             url('/assets/fonts/Fredoka/static/Fredoka-Bold.ttf') format('truetype');
        font-weight: 900;
        font-style: normal;
        font-display: swap;
      }
      @font-face {
        font-family: 'ZCOOL KuaiLe';
        src: url('https://cdn.maskmysheet.com/jump-and-say-themes-pic/assets/fonts/Zcool/zcool-kuaile-chinese-simplified-400-normal.woff2') format('woff2'),
             url('/assets/fonts/Zcool/zcool-kuaile-chinese-simplified-400-normal.woff2') format('woff2');
        font-weight: 400;
        font-style: normal;
        font-display: swap;
      }

      body {
        overscroll-behavior: none;
        user-select: none;
        -webkit-user-select: none;
        background-color: #4c99ff;
        color: #333333;
        font-family: 'FredokaBoot', 'ZCOOL KuaiLe', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Noto Sans CJK SC', system-ui, -apple-system, sans-serif;
      }
      
      .kenney-panel {
        background-color: white;
        border: 4px solid #333333;
        border-radius: 32px;
        box-shadow: 0 8px 0 #333333;
      }

      .kenney-button {
    position: relative;
    background-color: #77b039;
    border: 4px solid #333333;
    border-radius: 20px;
    color: white;
    padding: 12px 24px;
    font-weight: 900;
    text-transform: uppercase;
    transition: all 0.1s ease;
    box-shadow: 0 8px 0 #333333;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    letter-spacing: 0.05em;
  }
  .kenney-button-circle {
    position: relative;
    background-color: #ff5c5c;
    border: 4px solid #333333;
    border-radius: 50%;
    color: white;
    width: 48px;
    height: 48px;
    font-weight: 900;
    transition: all 0.1s ease;
    box-shadow: 0 6px 0 #333333;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  @media (min-width: 768px) {
    .kenney-button-circle {
      width: 64px;
      height: 64px;
    }
  }
  .kenney-button:active, .kenney-button-circle:active {
    transform: translateY(4px);
    box-shadow: 0 4px 0 #333333;
  }
  .kenney-button-red {
    background-color: #ff5c5c;
  }

      .kenney-button-blue { background-color: #4c99ff; }
      .kenney-button-red { background-color: #ff5c5c; }
      .kenney-button-yellow { background-color: #ffcc00; color: #333333; }

      /* Animations */
      @keyframes bounce-horizontal-large {
        0%, 100% { transform: translateX(0); }
        50% { transform: translateX(-30px); }
      }
      @keyframes bounce-horizontal-large-reverse {
        0%, 100% { transform: translateX(0); }
        50% { transform: translateX(30px); }
      }
      .animate-bounce-horizontal-large {
        animation: bounce-horizontal-large 1s infinite;
      }
      .animate-bounce-horizontal-large-reverse {
        animation: bounce-horizontal-large-reverse 1s infinite;
      }

      /* Hide scrollbar for Chrome, Safari and Opera */
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }

      /* Hide scrollbar for IE, Edge and Firefox */
      .scrollbar-hide {
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;  /* Firefox */
      }
    </style>
    <script>
      (function () {
        if (!('fonts' in document)) {
          console.warn('[Font] FontFaceSet API is not available in this browser.');
          return;
        }

        var fontSet = document.fonts;
        var fontSpecs = [
          '400 24px "FredokaBoot"',
          '700 24px "FredokaBoot"',
          '900 24px "FredokaBoot"'
        ];

        var getMissingSpecs = function () {
          return fontSpecs.filter(function (spec) {
            return !fontSet.check(spec);
          });
        };

        var checkFredoka = function (source) {
          var missingSpecs = getMissingSpecs();
          if (missingSpecs.length > 0) {
            console.warn('[Font] FredokaBoot not fully loaded (' + source + '). Missing:', missingSpecs);
          } else {
            console.info('[Font] FredokaBoot is ready (' + source + ').');
          }
        };

        fontSet.addEventListener('loadingerror', function () {
          console.warn('[Font] Browser reported a font loading error event while loading FredokaBoot.');
        });

        Promise.race([
          Promise.allSettled(fontSpecs.map(function (spec) { return fontSet.load(spec); })),
          new Promise(function (resolve) { setTimeout(resolve, 2500); })
        ]).then(function () {
          var firstMissingSpecs = getMissingSpecs();
          if (firstMissingSpecs.length === 0) {
            checkFredoka('index-bootstrap');
            return;
          }

          Promise.allSettled(firstMissingSpecs.map(function (spec) { return fontSet.load(spec); })).then(function () {
            checkFredoka('index-bootstrap');
          });
        });
      })();
    </script>
    
    <!-- MediaPipe Pose Lite (v0.5) - Multi-CDN Fallback -->
    <script>
      (function() {
        'use strict';
        const CANDIDATE_BASES = [
          'https://fastly.jsdelivr.net/npm/@mediapipe/pose@0.5.1675469404/',
          'https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1675469404/',
          'https://cdn.maskmysheet.com/mediapipe/pose_lite/'
        ];
        const LOAD_TIMEOUT = 8000;
        const TOTAL_TIMEOUT = 2 * 60 * 1000;
        let timedOut = false;
        let scriptLoaded = false;
        let baseCursor = 0;
        let timeoutHandle = null;
        
        function log(msg, type = 'info') {
          const style = type === 'error' ? 'color: red; font-weight: bold;' : 
                       type === 'success' ? 'color: green; font-weight: bold;' : 'color: blue;';
          console.log(`%c[MediaPipe Pose] ${msg}`, style);
        }

        function showTimeoutMessage() {
          if (document.getElementById('mediapipe-pose-timeout')) return;
          const overlay = document.createElement('div');
          overlay.id = 'mediapipe-pose-timeout';
          overlay.style.position = 'fixed';
          overlay.style.left = '0';
          overlay.style.top = '0';
          overlay.style.width = '100%';
          overlay.style.height = '100%';
          overlay.style.background = 'rgba(10, 10, 10, 0.78)';
          overlay.style.color = '#fff';
          overlay.style.display = 'flex';
          overlay.style.alignItems = 'center';
          overlay.style.justifyContent = 'center';
          overlay.style.textAlign = 'center';
          overlay.style.zIndex = '9999';
          overlay.style.fontFamily = '"FredokaBoot", "ZCOOL KuaiLe", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "Noto Sans CJK SC", system-ui, -apple-system, sans-serif';
          overlay.style.fontSize = '18px';
          overlay.style.padding = '24px';
          overlay.textContent = 'AI模型加载失败，请检查网络后重试。';
          document.body.appendChild(overlay);
        }

        function clearTimeoutMessage() {
          const overlay = document.getElementById('mediapipe-pose-timeout');
          if (overlay) overlay.remove();
        }

        function isLoaded() {
          return scriptLoaded || typeof window.Pose === 'function';
        }

        function markLoaded(base) {
          scriptLoaded = true;
          timedOut = false;
          if (base) {
            window.__MEDIAPIPE_POSE_CDN__ = base;
          }
          if (timeoutHandle !== null) {
            clearTimeout(timeoutHandle);
            timeoutHandle = null;
          }
          clearTimeoutMessage();
        }

        function loadScript(url, onSuccess, onError) {
          const script = document.createElement('script');
          script.src = url + 'pose.js';
          script.crossOrigin = 'anonymous';
          
          let timeoutId = setTimeout(() => {
             log(`Timeout loading from: ${url}`, 'error');
             script.onerror();
          }, LOAD_TIMEOUT);

          script.onload = function() {
            clearTimeout(timeoutId);
            if (typeof window.Pose !== 'function') {
              log(`Loaded but Pose global missing from: ${url}`, 'error');
              script.remove();
              onError();
              return;
            }
            log(`Successfully loaded from: ${url}`, 'success');
            onSuccess(url);
          };
          script.onerror = function() {
            clearTimeout(timeoutId);
            log(`Failed to load from: ${url}`, 'error');
            script.remove();
            onError();
          };
          document.head.appendChild(script);
        }

        function nextBase() {
          if (timedOut) return null;
          const base = CANDIDATE_BASES[baseCursor];
          baseCursor = (baseCursor + 1) % CANDIDATE_BASES.length;
          return base;
        }

        window.__MEDIAPIPE_POSE_NEXT_BASE__ = function() {
          return nextBase();
        };

        function tryLoadLoop() {
          if (timedOut || isLoaded()) return;
          const base = nextBase();
          if (!base) return;
          loadScript(base, function(successUrl) {
            markLoaded(successUrl);
            log(`Using base: ${successUrl}`, 'success');
          }, function() {
            tryLoadLoop();
          });
        }

        if (isLoaded()) {
          markLoaded(window.__MEDIAPIPE_POSE_CDN__ || null);
          return;
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', function() { tryLoadLoop(); });
        } else {
          tryLoadLoop();
        }

        timeoutHandle = setTimeout(function() {
          if (isLoaded() || timedOut) return;
          timedOut = true;
          log('Load timeout after 2 minutes', 'error');
          showTimeoutMessage();
        }, TOTAL_TIMEOUT);
      })();
    </script>
    
    <script>
      // Production-safe logging system
      const LOG_LEVEL = {
        DEBUG: 0,
        INFO: 1,
        WARN: 2,
        ERROR: 3
      };
      const isLocalDevHost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
      const CURRENT_LOG_LEVEL = isLocalDevHost ? LOG_LEVEL.INFO : LOG_LEVEL.WARN;

      function log(level, tag, message, data) {
        if (level < CURRENT_LOG_LEVEL) return;
        const prefix = `[${tag}]`;
        if (level === LOG_LEVEL.DEBUG) console.debug(prefix, message, data);
        else if (level === LOG_LEVEL.INFO) console.info(prefix, message, data);
        else if (level === LOG_LEVEL.WARN) console.warn(prefix, message, data);
        else console.error(prefix, message, data);
      }
    </script>
</head>
  <body class="overflow-hidden m-0 p-0 font-sans">
    <div id="root" class="w-full h-full absolute inset-0 z-10"></div>
  <script type="module" src="/index.tsx"></script>
</body>
</html>
